<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Fedora Atomic Batch Operations Specification</title>
    <meta charset='utf-8'>
    <meta name="description" content="Fedora Atomic Operations Specification">
    <script src='https://www.w3.org/Tools/respec/respec-w3c-common'
            async class='remove'></script>
    <script class='remove'>
      var respecConfig = {
          specStatus: "unofficial",
          shortName:  "fedora-abo",
          includePermalinks: true,
          formerEditors: [
                {   name:       "Ben Armintor",
                    company:    "Columbia University",
                    companyURL: "http://library.columbia.edu/"},
                {   name:       "Aaron Birkland",
                    company:    "Johns Hopkins",
                    companyURL: "http://www.library.jhu.edu/"},
                {   name:       "Aaron Coburn",
                    company:    "Amherst College",
                    companyURL: "https://www.amherst.edu/"},
                {   name:       "Sergio Fern√°ndez",
                    company:    "Redlink",
                    companyURL: "http://redlink.co/"},
                {   name:       "Tom Johnson",
                    company:    "Digital Public Library of America",
                    companyURL: "https://dp.la/"},
                {   name:       "Nick Ruest",
                    company:    "York University",
                    companyURL: "http://www.library.yorku.ca"},
                {   name:       "Rob Sanderson",
                    company:    "The Getty Trust",
                    companyURL: "http://www.getty.edu/"},
                {   name:       "Bethany Seeger",
                    company:    "Amherst College",
                    companyURL: "https://www.amherst.edu/library"},
                {   name:       "Adam Soroka",
                    company:    "University of Virginia",
                    companyURL: "https://www.virginia.edu/"},
                {   name:       "Simeon Warner",
                    company:    "Cornell University",
                    companyURL: "http://www.cornell.edu/"},
                {   name:       "Joshua Westgard",
                    company:    "University of Maryland",
                    companyURL: "http://www.lib.umd.edu/"},
                {   name:       "Jared Whiklo",
                    company:    "University of Manitoba",
                    companyURL: "http://umanitoba.ca"},
                {   name:       "Andrew Woods",
                    company:    "DuraSpace",
                    companyURL: "http://duraspace.org/"}
          ],
          editors: [
                {   name:       "Peter Eichman",
                    company:    "University of Maryland",
                    companyURL: "https://www.lib.umd.edu/"}
          ],
          edDraftURI: "https://fcrepo.github.io/fcrepo-specification-atomic-operations/",
          testSuiteURI: "https://github.com/fcrepo/fcrepo-tcks",
          wg:           "Fedora Specification Working Group",
          wgURI:        "https://wiki.duraspace.org/display/FEDORAAPI/Fedora+Specification",
          wgPublicList: "https://groups.google.com/forum/#!forum/fedora-community",
          otherLinks: [{
            key: "Repository",
            data: [
              {
                value: "Github",
                href: "https://github.com/fcrepo/fcrepo-specification-atomic-operations"
              },
              {
                value: "Issues",
                href: "https://github.com/fcrepo/fcrepo-specification-atomic-operations/issues"
              },
              {
                value: "Commits",
                href: "https://github.com/fcrepo/fcrepo-specification-atomic-operations/commits"
              }
            ]
          }],
          maxTocLevel: 3,
          logos: [{src: "http://fedora.info/assets/fedora_logo.png"}],
          overrideCopyright: "<p class='copyright'>This document is licensed under a <a class='subfoot' href='https://creativecommons.org/licenses/by/4.0/' rel='license'>Creative Commons Attribution 4.0 License</a>.</p>"
      };
    </script>
  </head>
	<body>
    <section id='abstract' class='informative'>
    </section>
    <section id="conformance">
    </section>
		<section id="terminology">
		</section>
    <section id ="atomic-operations">
      <h2>Atomic Operations</h2>

      <section id="atomic-operations-introduction" class="informative">
        <h2>Introduction</h2>
        <p>
          Fedora provides factilities by which to conduct multiple operations
          against a repository in an atomic fashion.
        </p>
        <pre class="http">
          # Discover the transaction endpoint

          HEAD http://example.org/foo

          200 OK
          Link: &lt;http://example.org/foo/fcr:tx>; rel="[URI TBD]"

          # Begin a transaction

          POST http://example.org/foo/fcr:tx

          201 Created
          Location: http://example.org/foo/fcr:tx/01234567-89ab-cdef-0123-456789abcdef

          # Create a new resource within the transaction

          POST http://example.org/foo
          Atomic-ID: http://example.org/foo/fcr:tx/01234567-89ab-cdef-0123-456789abcdef

          201 Created
          Location: http://example.org/foo/abcdef01-2345-6789-abcd-ef0123456789
          Link: &lt;http://example.org/foo/fcr:tx/01234567-89ab-cdef-0123-456789abcdef>; rel="[URI TBD]"

          # That resource is not visible outside of the transaction

          HEAD http://example.org/foo/abcdef01-2345-6789-abcd-ef0123456789

          404 Not Found

          # But is visible within the transaction

          HEAD http://example.org/foo/abcdef01-2345-6789-abcd-ef0123456789
          Atomic-ID: http://example.org/foo/fcr:tx/01234567-89ab-cdef-0123-456789abcdef

          200 OK

          # Commit the transaction

          PUT http://example.org/foo/fcr:tx/01234567-89ab-cdef-0123-456789abcdef

          204 No Content

          # Now the new resource is visible outside the transaction

          HEAD http://example.org/foo/abcdef01-2345-6789-abcd-ef0123456789

          200 OK
        </pre>
      </section>

      <section id="scope">
        <h2>Transaction scope</h2>
        <p>
          Transactions are scoped to a resource and its path-wise children. In
          this context, the resource is known as the <dfn>transaction
          root</dfn>. The URI of this resource is a <dfn>transaction root
          URI</dfn>.
        </p>
      </section>

      <section id="identify">
        <h2>Advertising support for atomic operations</h2>
        <p>
          A server that supports atomic operations MUST advertise this support
          by including a <code>Link</code> header in responses to requests to
          resources that can be transaction roots. The value of this link
          header MUST be a resolvable HTTP URI. This URI is known as the
          <dfn>transaction endpoint</dfn>. The <code>rel</code> parameter of
          this header MUST be [URI TBD].
        </p>
      </section>

      <section id="begin">
        <h2>Beginning an atomic series of operations</h2>
        <p>
          A client begins an atomic series of requests by sending a POST request
          to a transaction endpoint.
        </p>
        <p>
          If the server is able to create the transaction, it MUST respond with
          a <code>201 Created</code> HTTP status and MUST include a
          <code>Location</code> header that contains the <dfn>transaction
          URI</dfn>.
        </p>
      </section>

      <section id="adding">
        <h2>Adding to an atomic series of operations</h2>
        <p>
          A client adds to an atomic batch operation by including an
          <code>Atomic-ID</code> request header. The value of this header is an
          active transaction URI.
        </p>
        <p>
          The effect of the request, if it has one, and if the request is
          successful, MUST be visible to clients using that identifier to add to
          this series of requests, as described here, until the series expires
          or is finished. The effect of the request, if it has one, and if the
          request is successful, SHOULD NOT be visible to clients not using that
          identifier to add to this series of requests.  The effect of the
          request MUST NOT be durable unless and until the series is
          successfully <a href="#commit">finished</a>.
        </p>
        <p>
          If the request is successful, the server MUST include a
          <code>Link</code> response header whose value MUST be the current
          transaction URI. The <code>rel</code> parameter MUST be [URI TBD].
        <p>
          If the client sending the current request is not authorized to access
          the transaction identified by the <code>Atomic-ID</code> header, the
          server MUST NOT update any resources, and MUST respond with a
          <code>404 Not Found</code> HTTP status.
        </p>
        <p>
          If the client is authorized but the transaction identified by the
          <code>Atomic-ID</code> header is inactive, the server MUST NOT update
          any resources, and it MUST respond with a <code>409 Conflict</code>
          HTTP status.
        </p>
      </section>

      <section id="expiration">
        <h2>Expiration</h2>
        <p>
          An implementation MAY enforce automatic expiration for an atomic
          series of requests.  If so, the response to any request made as part
          of the series MUST have a <code>Atomic-Expires</code> header with the
          HTTP datetime at which the series will expire.
        </p>
        <p>
          An implementation SHOULD extend the lifetime of a series upon the
          receipt of any request to resources within the scope of the
          transaction.
        </p>
        <p>
          An implementation SHOULD permit extending the lifetime of a series by
          a <code>POST</code> request to the transaction URI.
      </section>

      <section id="commit">
        <h2>Committing a series</h2>
        <p>
          A client finishes an atomic series of requests by sending a
          <code>PUT</code> request to the transaction URI.
        </p>
        <p>
          The effects of all requests in the series MUST become durable and MUST
          become visible to all clients. The transaction URI of the series MUST
          be expired and MUST NOT be reused.
        </p>
      </section>

      <section id="abort">
        <h2>Aborting a series</h2>
        <p>
          A client aborts an atomic series of requests by sending a
          <code>DELETE</code> request to the transaction URI.
        </p>
        <p>
          The effects of all requests in the series MUST disappear to all
          clients, and MUST be durably gone. The transaction URI of the series
          MUST be expired and MUST NOT be reused.
        </p>
      </section>
    </section>
    <section class='appendix'>
      <h2>Acknowledgments</h2>
      <p>
      </p>
    </section>
  </body>
</html>
